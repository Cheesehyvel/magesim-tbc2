importScripts("./magesim.js"),onmessage=function(e){var n=e.data;"start"==n.type&&fetch("./magesim.wasm",{cache:"no-store"}).then(function(e){return e.arrayBuffer()}).then(function(e){return MageSim({wasmBinary:e})}).then(function(e){return e.ready}).then(function(e){var o=e.allocConfig();for(var a in n.config)if(a.indexOf("_t")&&Array.isArray(n.config[a])){for(var i=new e.VectorDouble,t=0;t<n.config[a].length&&"number"==typeof n.config[a][t];t++)i.push_back(n.config[a][t]);o[a]=i}else void 0!==o[a]&&(o[a]=n.config[a]);e.MainRotation.values.hasOwnProperty(n.config.main_rotation)&&(o.main_rotation=e.MainRotation.values[n.config.main_rotation]),e.RegenRotation.values.hasOwnProperty(n.config.regen_rotation)&&(o.regen_rotation=e.RegenRotation.values[n.config.regen_rotation]),e.Trinket.values.hasOwnProperty(n.config.trinket1)&&(o.trinket1=e.Trinket.values[n.config.trinket1]),e.Trinket.values.hasOwnProperty(n.config.trinket2)&&(o.trinket2=e.Trinket.values[n.config.trinket2]),e.MetaGem.values.hasOwnProperty(n.config.meta_gem)&&(o.meta_gem=e.MetaGem.values[n.config.meta_gem]),e.Flask.values.hasOwnProperty(n.config.flask)&&(o.flask=e.Flask.values[n.config.flask]),e.Elixir.values.hasOwnProperty(n.config.battle_elixir)&&(o.battle_elixir=e.Elixir.values[n.config.battle_elixir]),e.Elixir.values.hasOwnProperty(n.config.guardian_elixir)&&(o.guardian_elixir=e.Elixir.values[n.config.guardian_elixir]),e.WeaponOil.values.hasOwnProperty(n.config.weapon_oil)&&(o.weapon_oil=e.WeaponOil.values[n.config.weapon_oil]),e.Food.values.hasOwnProperty(n.config.food)&&(o.food=e.Food.values[n.config.food]),e.Drums.values.hasOwnProperty(n.config.drums)&&(o.drums=e.Drums.values[n.config.drums]),e.Potion.values.hasOwnProperty(n.config.potion)&&(o.potion=e.Potion.values[n.config.potion]),e.Potion.values.hasOwnProperty(n.config.first_potion)&&(o.first_potion=e.Potion.values[n.config.first_potion]),e.Conjured.values.hasOwnProperty(n.config.conjured)&&(o.conjured=e.Conjured.values[n.config.conjured]);var r=e.allocPlayer(o),s=JSON.parse(JSON.stringify(r.stats));for(var a in n.config.stats)s.hasOwnProperty(a)&&(s[a]=n.config.stats[a]);if(e.Race.values.hasOwnProperty(n.config.race)&&(r.race=e.Race.values[n.config.race]),r.setStats(s),n.config.talents){var l=function(e){if(e.match(/^[0-9\-]+$/))return e;var n=e.match(/talent-calc\/mage\/(.*)/i);return n?n[1]:"---"}(n.config.talents);r.loadTalentsFromString(l)}if(n.iterations&&n.iterations>1)var c=e.runSimulations(o,r,n.iterations);else c=e.runSimulation(o,r);c.log&&(c.log=JSON.parse(c.log)),c.spells&&(c.spells=JSON.parse(c.spells)),c.histogram&&(c.histogram=JSON.parse(c.histogram)),c.stats&&(c.stats=JSON.parse(c.stats)),postMessage({type:"success",result:c})}).catch(function(e){return console.error(e)})};